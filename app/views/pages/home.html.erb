<div class="flex flex-col md:flex-row h-[calc(100vh-80px)]">
  <!-- Sidebar pour les filtres et la liste -->
  <div class="w-full md:w-1/3 lg:w-1/4 overflow-hidden flex flex-col bg-white">
    <div class="p-4 sticky top-0 bg-white z-10 border-b border-gray-200">
      <form action="/" method="get" class="mb-4">
        <div class="relative">
          <input 
            type="text" 
            name="search" 
            placeholder="Rechercher un lieu, une activité..." 
            class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-600 focus:border-green-600"
          >
          <div class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">
            <i class="fas fa-search"></i>
          </div>
        </div>
      </form>
      
      <h2 class="font-semibold text-lg mb-3">Catégories</h2>
      <div class="flex flex-wrap gap-2">
        <% category_map = {
          "all" => "Tout voir",
          "charity" => "Aide caritative",
          "education" => "Éducation",
          "health" => "Santé"
        } %>
        
        <% category_map.each do |key, label| %>
          <% is_active = params[:category] == key || (key == "all" && params[:category].blank?) %>
          <%= link_to root_path(category: key == "all" ? nil : key, search: params[:search]), class: "px-3 py-1.5 rounded-full text-sm font-medium transition-all #{is_active ? 'bg-green-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-green-600 hover:text-white'}" do %>
            <% if key == "charity" %>
              <i class="fas fa-hand-holding-heart mr-1"></i>
            <% elsif key == "education" %>
              <i class="fas fa-graduation-cap mr-1"></i>
            <% elsif key == "health" %>
              <i class="fas fa-heart-pulse mr-1"></i>
            <% end %>
            <%= label %>
          <% end %>
        <% end %>
      </div>
    </div>
    
    <div class="flex-1 overflow-auto p-4">
      <div id="locations-list" class="space-y-4">
        <% @locations.each do |location| %>
          <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-md cursor-pointer" data-location-id="<%= location.id %>">
            <% if location.image_url.present? %>
              <div class="w-full h-40 overflow-hidden">
                <img 
                  src="<%= location.image_url %>" 
                  alt="<%= location.name %>" 
                  class="w-full h-full object-cover transition-transform duration-300 hover:scale-105" 
                >
              </div>
            <% end %>
            <div class="p-4">
              <div class="flex justify-between items-start mb-2">
                <h3 class="font-semibold text-lg"><%= location.name %></h3>
                <span class="bg-green-600 text-white text-xs font-bold px-2 py-1 rounded-full">
                  <%= t("categories.#{location.category}", default: location.category.humanize) %>
                </span>
              </div>
              <p class="text-sm text-gray-500 mb-2"><%= location.address %></p>
              <p class="text-sm mb-3 line-clamp-2"><%= location.description %></p>
              <% if location.action_text.present? && location.action_url.present? %>
                <%= link_to location.action_text, location.action_url, class: "inline-block text-sm px-3 py-1.5 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors" %>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
  
  <!-- Carte -->
  <div class="hidden md:block md:w-2/3 lg:w-3/4 h-full" id="map-container" data-controller="map"></div>
</div>

<!-- JavaScript pour définir la hauteur mobile -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const updateHeight = () => {
      const header = document.querySelector('header');
      const headerHeight = header ? header.offsetHeight : 0;
      const mapContainer = document.getElementById('map-container');
      const windowHeight = window.innerHeight;
      
      if (mapContainer) {
        mapContainer.style.height = `${windowHeight - headerHeight}px`;
      }
    };
    
    updateHeight();
    window.addEventListener('resize', updateHeight);
    
    // Rendre les cartes cliquables pour centrer la carte sur ce marqueur
    document.querySelectorAll('[data-location-id]').forEach(card => {
      card.addEventListener('click', function() {
        const locationId = this.getAttribute('data-location-id');
        const mapController = document.getElementById('map-container').__stimulusMapController;
        if (mapController && mapController.focusLocation) {
          mapController.focusLocation(locationId);
        }
      });
    });
  });
</script>